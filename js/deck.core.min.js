/*!
Deck JS - deck.core
Copyright (c) 2011 Caleb Troughton
Dual licensed under the MIT license and GPL license.
https://github.com/imakewebthings/deck.js/blob/master/MIT-license.txt
https://github.com/imakewebthings/deck.js/blob/master/GPL-license.txt
*//*
The deck.core module provides all the basic functionality for creating and
moving through a deck.  It does so by applying classes to indicate the state of
the deck and its slides, allowing CSS to take care of the visual representation
of each state.  It also provides methods for navigating the deck and inspecting
its state, as well as basic key bindings for going to the next and previous
slides.  More functionality is provided by wholly separate extension modules
that use the API provided by core.
*/(function(e,t,n,r){var i,s,o,u={change:"deck.change",beforeInitialize:"deck.beforeInit",initialize:"deck.init"},a={},f=e(n),l=function(){var t=a.classes,n=a.selectors.container,r=o.data("onSlide"),u=e();o.removeClass(t.onPrefix+r).addClass(t.onPrefix+s).data("onSlide",s);e("."+t.current).parentsUntil(n).removeClass(t.childCurrent);i[s].parentsUntil(n).addClass(t.childCurrent);e.each(i,function(e,t){u=u.add(t)});u.removeClass([t.before,t.previous,t.current,t.next,t.after].join(" "));i[s].addClass(t.current);s>0&&i[s-1].addClass(t.previous);s+1<i.length&&i[s+1].addClass(t.next);s>1&&e.each(i.slice(0,s-1),function(e,n){n.addClass(t.before)});s+2<i.length&&e.each(i.slice(s+2),function(e,n){n.addClass(t.after)})},c={init:function(n,h){var p,d,v=function(e){e.stopPropagation()};a=e.extend(!0,{},e[t].defaults,h);i=[];s=0;o=e(a.selectors.container);d=a.touch.swipeTolerance;f.trigger(u.beforeInitialize);o.addClass(a.classes.loading);e.isArray(n)?e.each(n,function(t,n){i.push(e(n))}):e(n).each(function(t,n){i.push(e(n))});f.unbind("keydown.deck").bind("keydown.deck",function(t){if(t.which===a.keys.next||e.inArray(t.which,a.keys.next)>-1){c.next();t.preventDefault()}else if(t.which===a.keys.previous||e.inArray(t.which,a.keys.previous)>-1){c.prev();t.preventDefault()}}).undelegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",v).delegate("input, textarea, select, button, meter, progress, [contentEditable]","keydown",v);o.unbind("touchstart.deck").bind("touchstart.deck",function(t){p||(p=e.extend({},t.originalEvent.targetTouches[0]))}).unbind("touchmove.deck").bind("touchmove.deck",function(n){e.each(n.originalEvent.changedTouches,function(n,i){if(p&&i.identifier===p.identifier){if(i.screenX-p.screenX>d||i.screenY-p.screenY>d){e[t]("prev");p=r}else if(i.screenX-p.screenX<-1*d||i.screenY-p.screenY<-1*d){e[t]("next");p=r}return!1}});n.preventDefault()}).unbind("touchend.deck").bind("touchend.deck",function(t){e.each(t.originalEvent.changedTouches,function(e,t){p&&t.identifier===p.identifier&&(p=r)})}).scrollLeft(0).scrollTop(0);e.each(i,function(n,r){r.unbind("webkitTransitionEnd.deck").bind("webkitTransitionEnd.deck",function(n){if(r.hasClass(e[t]("getOptions").classes.current)){var i=e(this).find("iframe").css("opacity",0);window.setTimeout(function(){i.css("opacity",1)},100)}})});i.length&&l();o.removeClass(a.classes.loading);f.trigger(u.initialize)},go:function(t){var n=e.Event(u.change),r;typeof t=="number"&&t>=0&&t<i.length?r=t:typeof t=="string"&&e.each(i,function(e,n){if(n.attr("id")===t){r=e;return!1}});if(typeof r=="undefined")return;f.trigger(n,[s,r]);if(n.isDefaultPrevented())f.trigger(u.change,[r,s]);else{s=r;l()}},next:function(){c.go(s+1)},prev:function(){c.go(s-1)},getSlide:function(e){var t=typeof e!="undefined"?e:s;return typeof t!="number"||t<0||t>=i.length?null:i[t]},getSlides:function(){return i},getContainer:function(){return o},getOptions:function(){return a},extend:function(e,t){c[e]=t}};e[t]=function(e,t){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):c.init(e,t)};e[t].defaults={classes:{after:"deck-after",before:"deck-before",childCurrent:"deck-child-current",current:"deck-current",loading:"deck-loading",next:"deck-next",onPrefix:"on-slide-",previous:"deck-previous"},selectors:{container:".deck-container"},keys:{next:[13,32,34,39,40],previous:[8,33,37,38]},touch:{swipeTolerance:60}};f.ready(function(){e("html").addClass("ready")});f.bind("deck.change",function(n,r,i){var s=e[t]("getSlide",r).find("iframe"),o=e[t]("getSlide",i).find("iframe");s.each(function(){var t=e(this),n=t.attr("src");n&&t.data("deck-src",n).attr("src","")});o.each(function(){var t=e(this),n=t.data("deck-src");n&&t.attr("src",n)})})})(jQuery,"deck",document);