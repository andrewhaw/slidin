/*!
Deck JS - deck.menu
Copyright (c) 2011 Caleb Troughton
Dual licensed under the MIT license and GPL license.
https://github.com/imakewebthings/deck.js/blob/master/MIT-license.txt
https://github.com/imakewebthings/deck.js/blob/master/GPL-license.txt
*//*
This module adds the methods and key binding to show and hide a menu of all
slides in the deck. The deck menu state is indicated by the presence of a class
on the deck container.
*/(function(e,t,n){var r=e(document),i;e.extend(!0,e[t].defaults,{classes:{menu:"deck-menu"},keys:{menu:77},touch:{doubletapWindow:400}});e[t]("extend","showMenu",function(){var n=e[t]("getContainer"),r=e[t]("getOptions");if(n.hasClass(r.classes.menu))return;n.addClass([r.classes.loading,r.classes.menu].join(" "));Modernizr.csstransforms&&e.each(i,function(e,t){t.data("oldStyle",t.attr("style"));t.css({position:"absolute",left:e%4*25+"%",top:Math.floor(e/4)*25+"%"})});window.setTimeout(function(){n.removeClass(r.classes.loading).scrollTop(e[t]("getSlide").offset().top)},0)});e[t]("extend","hideMenu",function(){var n=e[t]("getContainer"),r=e[t]("getOptions");if(!n.hasClass(r.classes.menu))return;n.removeClass(r.classes.menu);n.addClass(r.classes.loading);Modernizr.csstransforms&&e.each(i,function(e,t){var n=t.data("oldStyle");t.attr("style",n?n:"")});window.setTimeout(function(){n.removeClass(r.classes.loading).scrollTop(0)},0)});e[t]("extend","toggleMenu",function(){e[t]("getContainer").hasClass(e[t]("getOptions").classes.menu)?e[t]("hideMenu"):e[t]("showMenu")});r.bind("deck.init",function(){var n=e[t]("getOptions"),s=0,o,u=e.map([n.classes.before,n.classes.previous,n.classes.current,n.classes.next,n.classes.after],function(e,t){return"."+e}).join(", ");i=[];e.each(e[t]("getSlides"),function(e,t){t.parentsUntil(n.selectors.container,u).length||i.push(t)});r.unbind("keydown.deckmenu").bind("keydown.deckmenu",function(r){if(r.which===n.keys.menu||e.inArray(r.which,n.keys.menu)>-1){e[t]("toggleMenu");r.preventDefault()}});e[t]("getContainer").unbind("touchstart.deckmenu").bind("touchstart.deckmenu",function(n){o=e[t]("getSlide")}).unbind("touchend.deckmenu").bind("touchend.deckmenu",function(r){var i=Date.now();if(o!==e[t]("getSlide"))return;if(i-s<n.touch.doubletapWindow){e[t]("toggleMenu");r.preventDefault()}s=i});e.each(e[t]("getSlides"),function(r,i){i.unbind("click.deckmenu").bind("click.deckmenu",function(i){if(!e[t]("getContainer").hasClass(n.classes.menu))return;e[t]("go",r);e[t]("hideMenu");i.stopPropagation();i.preventDefault()})})}).bind("deck.change",function(n,r,i){var s=e[t]("getContainer");s.hasClass(e[t]("getOptions").classes.menu)&&s.scrollTop(e[t]("getSlide",i).offset().top)})})(jQuery,"deck");